{%- comment -%}
  Card Carousel Section
  - Horizontal scrolling cards with infinite loop
  - Portrait image cards with content below
  - Navigation arrows and drag-to-scroll support
{%- endcomment -%}

{{ 'swiper.css' | asset_url | stylesheet_tag }}

{%- assign section_bg_rgb = section.settings.background_color | color_to_rgb -%}

<style>
  [data-section-id="{{ section.id }}"] {
    {% if section_bg_rgb != 'rgba(0, 0, 0, 0.0)' %}
      --card-carousel-bg: {{ section.settings.background_color }};
    {% else %}
      --card-carousel-bg: transparent;
    {% endif %}
    --card-carousel-padding-top: {{ section.settings.padding_top }}px;
    --card-carousel-padding-bottom: {{ section.settings.padding_bottom }}px;
    --card-carousel-radius: {{ section.settings.card_radius }}px;
    --card-carousel-gap: {{ section.settings.gap }}px;
  }

  [data-section-id="{{ section.id }}"].card-carousel {
    background-color: var(--card-carousel-bg);
    padding-top: var(--card-carousel-padding-top);
    padding-bottom: var(--card-carousel-padding-bottom);
  }

  [data-section-id="{{ section.id }}"] .card-carousel__inner {
    max-width: none;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }

  [data-section-id="{{ section.id }}"] .swiper-slide {
    width: {{ section.settings.card_width }}px;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__card {
    display: flex;
    flex-direction: column;
    border-radius: var(--card-carousel-radius);
    overflow: hidden;
    background-color: #f0f0f0;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__image-wrapper {
    position: relative;
    aspect-ratio: 3 / 4;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    min-height: 120px;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__title {
    font-size: {{ section.settings.title_font_size }}rem;
    font-weight: 600;
    line-height: 1.2;
    margin: 0;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__description {
    font-size: {{ section.settings.description_font_size }}rem;
    line-height: 1.5;
    margin: 0;
    opacity: 0.9;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 1.5rem;
    padding: 0 1.5rem;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav-btn {
    position: static;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid currentColor;
    border-radius: 50%;
    background: transparent;
    color: {{ section.settings.arrow_color }};
    cursor: pointer;
    transition: opacity 0.2s ease;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav-btn:hover {
    opacity: 0.7;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav-btn.swiper-button-disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav-btn::after {
    display: none;
  }

  /* CSS-only arrow icons */
  [data-section-id="{{ section.id }}"] .card-carousel__arrow {
    display: grid;
    place-items: center;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__arrow::before {
    content: "";
    width: 10px;
    height: 10px;
    border-style: solid;
    border-width: 0 2px 2px 0;
    border-color: currentColor;
    transform: rotate(-45deg);
    margin-left: -3px;
  }

  [data-section-id="{{ section.id }}"] .card-carousel__nav-prev .card-carousel__arrow::before {
    border-width: 2px 0 0 2px;
    margin-left: 3px;
    margin-right: 0;
  }

  /* Block-level styles for content */
  {% for block in section.blocks %}
    {% case block.type %}
      {% when 'card' %}
        [data-block-id="{{ block.id }}"] .card-carousel__content {
          background: {{ block.settings.content_background }};
          color: {{ block.settings.text_color }};
        }
    {% endcase %}
  {% endfor %}
</style>

<script type="module" src="{{ 'slider.js' | asset_url }}" defer="defer"></script>

<div data-section-id="{{ section.id }}" class="card-carousel">
  <div class="card-carousel__inner">
    {% if section.blocks.size == 0 %}
      <p style="text-align: center; padding: 2rem; color: #666;">Add card blocks using the theme editor</p>
    {% else %}
      <slideshow-section class="card-carousel__slider">
        <div data-swiper class="swiper">
          <div data-swiper-container class="swiper-wrapper">
            {% for block in section.blocks %}
              {% case block.type %}
                {% when 'card' %}
                  <div
                    data-swiper-slide
                    class="swiper-slide"
                    data-block-id="{{ block.id }}"
                    {{ block.shopify_attributes }}
                  >
                    <div class="card-carousel__card">
                      <div class="card-carousel__image-wrapper">
                        {% if block.settings.image != blank %}
                          <img
                            class="card-carousel__image"
                            src="{{ block.settings.image | image_url: width: 600 }}"
                            srcset="
                              {{ block.settings.image | image_url: width: 400 }} 400w,
                              {{ block.settings.image | image_url: width: 600 }} 600w,
                              {{ block.settings.image | image_url: width: 800 }} 800w
                            "
                            sizes="(max-width: 600px) 80vw, (max-width: 900px) 45vw, 25vw"
                            alt="{{ block.settings.image.alt | escape }}"
                            loading="lazy"
                            width="{{ block.settings.image.width }}"
                            height="{{ block.settings.image.height }}"
                          >
                        {% else %}
                          {{ 'image' | placeholder_svg_tag: 'card-carousel__image placeholder-svg' }}
                        {% endif %}
                      </div>
                      <div class="card-carousel__content">
                        {% if block.settings.title != blank %}
                          <h3 class="card-carousel__title">{{ block.settings.title }}</h3>
                        {% endif %}
                        {% if block.settings.description != blank %}
                          <p class="card-carousel__description">{{ block.settings.description }}</p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
              {% endcase %}
            {% endfor %}
          </div>
        </div>

        <div class="card-carousel__nav">
          <button class="card-carousel__nav-btn card-carousel__nav-prev swiper-button-prev" aria-label="Previous slide">
            <span class="card-carousel__arrow"></span>
          </button>
          <button class="card-carousel__nav-btn card-carousel__nav-next swiper-button-next" aria-label="Next slide">
            <span class="card-carousel__arrow"></span>
          </button>
        </div>

        <script data-swiper-configuration type="text/json">
          {
            "slidesPerView": "auto",
            "spaceBetween": {{ section.settings.gap }},
            "grabCursor": true,
            "enableOnMedia": "(min-width: 0px)",
            {% if section.blocks.size > 1 %}
              "loop": true,
            {% endif %}
            "navigation": {
              "nextEl": ".card-carousel__nav-next",
              "prevEl": ".card-carousel__nav-prev"
            }
          }
        </script>
      </slideshow-section>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "MH Card Carousel",
  "tag": "section",
  "class": "card-carousel-section",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "card_width",
      "label": "Card width",
      "min": 200,
      "max": 400,
      "step": 10,
      "default": 280,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap between cards",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 32,
      "step": 2,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Title font size",
      "min": 1,
      "max": 3,
      "step": 0.1,
      "default": 1.5,
      "unit": "rem"
    },
    {
      "type": "range",
      "id": "description_font_size",
      "label": "Description font size",
      "min": 0.8,
      "max": 1.5,
      "step": 0.1,
      "default": 0.9,
      "unit": "rem"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section background",
      "default": "transparent"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 60,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Card title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Add a short description for this card."
        },
        {
          "type": "header",
          "content": "Content styling"
        },
        {
          "type": "color",
          "id": "content_background",
          "label": "Content background",
          "default": "#1a1a1a"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#ffffff"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "MH Card Carousel",
      "blocks": [
        {
          "type": "card",
          "settings": {
            "title": "Sustained energy",
            "description": "B vitamins support energy and focus without the caffeine crash.",
            "content_background": "#1a1a1a",
            "text_color": "#ffffff"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Immune defence",
            "description": "Vitamin C from citrus fruits and minerals like zinc support your immune function.",
            "content_background": "#1a1a1a",
            "text_color": "#ffffff"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Regular digestion",
            "description": "Calcium supports digestive enzymes, biotin helps maintain the gut lining.",
            "content_background": "#1a1a1a",
            "text_color": "#ffffff"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Stress management",
            "description": "B vitamins support stress management, resilience and the nervous system.",
            "content_background": "#1a1a1a",
            "text_color": "#ffffff"
          }
        }
      ]
    }
  ]
}
{% endschema %}
